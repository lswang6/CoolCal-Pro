<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoolCalc Pro - WordPress Elementor Version</title>
    <!-- Use Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Use Alpine.js CDN -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900" x-data="app()">
    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="space-y-8">

            <!-- Input Section -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold flex items-center gap-2">
                        <i class="fas fa-sliders-h text-blue-500"></i>
                        <span x-text="lang === 'en' ? 'Configuration' : 'Configuration'"></span>
                    </h2>
                    <button @click="lang = (lang === 'en' ? 'fr' : 'en')"
                        class="flex items-center gap-2 px-3 py-1.5 rounded-full border border-slate-200 hover:bg-slate-50 transition-colors text-xs font-bold text-slate-600 shadow-sm">
                        <i class="fas fa-globe text-blue-500"></i>
                        <span x-text="lang === 'en' ? 'FR' : 'EN'"></span>
                    </button>
                </div>

                <div class="space-y-8">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2" x-text="t().areaLabel"></label>
                        <div class="flex flex-col sm:flex-row items-center gap-6">
                            <div class="relative w-full sm:w-[160px]">
                                <input type="number" x-model.number="area" step="0.1"
                                    class="w-full pl-4 pr-12 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none font-bold text-lg" />
                                <span
                                    class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold select-none pointer-events-none">m²</span>
                            </div>
                            <div
                                class="flex-1 w-full flex items-center gap-4 bg-slate-50 p-4 rounded-xl border border-slate-100">
                                <span class="text-[10px] font-bold text-slate-400 w-8">2m²</span>
                                <input type="range" min="2" max="1000" step="0.1" x-model.number="area"
                                    class="flex-1 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600" />
                                <span class="text-[10px] font-bold text-slate-400 w-12 text-right">1000m²</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2"
                                x-text="t().roomTypeLabel"></label>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                                <template x-for="(label, type) in t().roomTypes" :key="type">
                                    <button @click="roomType = type"
                                        :class="roomType === type ? 'bg-blue-600 border-blue-600 text-white shadow-md shadow-blue-100' : 'bg-white border-slate-200 text-slate-600 hover:border-blue-300'"
                                        class="px-3 py-3 rounded-xl text-xs font-bold border transition-all flex flex-col items-center gap-2">
                                        <i :class="getRoomIcon(type)"></i>
                                        <span x-text="label"></span>
                                    </button>
                                </template>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-3"
                                x-text="t().factorsTitle"></label>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                <template x-for="(label, key) in t().factors" :key="key">
                                    <label
                                        class="flex items-center p-3 rounded-xl border border-slate-100 hover:bg-slate-50 cursor-pointer transition-colors group">
                                        <input type="checkbox" x-model="factors[key]"
                                            class="w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500" />
                                        <span class="ml-3 text-sm text-slate-600 font-medium group-hover:text-slate-900"
                                            x-text="label"></span>
                                    </label>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                <!-- Results Display -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col h-full">
                    <h2 class="text-lg font-bold mb-8 flex items-center gap-2">
                        <i class="fas fa-chart-line text-blue-500"></i>
                        <span x-text="t().resultsTitle"></span>
                    </h2>

                    <div x-show="result" x-transition>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div
                                class="bg-slate-50 p-4 rounded-xl border border-slate-100 flex flex-col items-center text-center">
                                <span class="text-[10px] font-black uppercase text-slate-400 mb-1"
                                    x-text="t().kwLabel"></span>
                                <span class="text-2xl font-black text-slate-800" x-text="result.kw.toFixed(2)"></span>
                            </div>
                            <div
                                class="bg-slate-50 p-4 rounded-xl border border-slate-100 flex flex-col items-center text-center">
                                <span class="text-[10px] font-black uppercase text-slate-400 mb-1"
                                    x-text="t().btuLabel"></span>
                                <span class="text-2xl font-black text-slate-800"
                                    x-text="Math.round(result.btu).toLocaleString()"></span>
                            </div>
                            <div
                                class="bg-slate-50 p-4 rounded-xl border border-slate-100 flex flex-col items-center text-center">
                                <span class="text-[10px] font-black uppercase text-slate-400 mb-1"
                                    x-text="t().hpLabel"></span>
                                <span class="text-2xl font-black text-slate-800" x-text="result.hp.toFixed(2)"></span>
                            </div>
                        </div>

                        <button @click="addRecord" :disabled="records.length >= 20"
                            class="w-full py-4 bg-blue-600 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition-all shadow-lg shadow-blue-100 disabled:opacity-50 mb-6">
                            <i class="fas fa-check-circle"></i>
                            <span x-text="t().confirmBtn + (records.length >= 20 ? ' (Limit 20)' : '')"></span>
                        </button>

                        <div class="mt-auto" x-show="result.adjustmentMultiplier > 1">
                            <div
                                class="p-3 bg-orange-50 border border-orange-100 rounded-xl text-orange-800 text-xs flex items-start gap-2">
                                <i class="fas fa-exclamation-triangle mt-0.5"></i>
                                <p
                                    x-text="lang === 'en' ? `Applied ${Math.round((result.adjustmentMultiplier - 1) * 100)}% adjustment for environmental factors.` : `Adapté de ${Math.round((result.adjustmentMultiplier - 1) * 100)}% pour les facteurs environnementaux.`">
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Records List -->
                <div
                    class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col h-full min-h-[400px]">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-bold flex items-center gap-2">
                            <i class="fas fa-list-ul text-blue-500"></i>
                            <span x-text="t().recordsTitle"></span>
                        </h2>
                        <div class="flex gap-2">
                            <button @click="exportCSV" :disabled="records.length === 0"
                                class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-30"
                                :title="t().exportBtn">
                                <i class="fas fa-file-export text-xl"></i>
                            </button>
                            <button @click="records = []" :disabled="records.length === 0"
                                class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-30"
                                :title="t().clearAllBtn">
                                <i class="fas fa-trash-alt text-xl"></i>
                            </button>
                        </div>
                    </div>

                    <div class="flex-1 space-y-3 overflow-y-auto max-h-[400px] pr-2 custom-scrollbar">
                        <div x-show="records.length === 0"
                            class="h-full flex flex-col items-center justify-center text-slate-400 space-y-2">
                            <i class="fas fa-folder-open text-4xl"></i>
                            <p class="text-sm font-medium" x-text="t().noRecords"></p>
                        </div>
                        <template x-for="(rec, index) in records" :key="rec.id">
                            <div
                                class="p-4 bg-slate-50 border border-slate-100 rounded-xl flex justify-between items-center group">
                                <div class="space-y-1">
                                    <div class="flex items-center gap-2">
                                        <span class="font-bold text-slate-800" x-text="rec.roomName"></span>
                                        <span
                                            class="text-[10px] px-1.5 py-0.5 bg-slate-200 text-slate-600 rounded uppercase font-black"
                                            x-text="t().roomTypes[rec.roomType].split(' / ')[0]"></span>
                                    </div>
                                    <p class="text-xs text-slate-500 font-medium">
                                        Area: <span class="text-slate-700 font-bold" x-text="rec.area + ' m²'"></span> |
                                        Capacity: <span class="text-blue-600 font-bold"
                                            x-text="rec.kw.toFixed(2) + ' kW'"></span>
                                    </p>
                                </div>
                                <button @click="records.splice(index, 1)"
                                    class="p-2 text-slate-300 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </template>
                    </div>

                    <div
                        class="mt-4 pt-4 border-t border-slate-100 flex justify-between items-center text-[10px] font-bold text-slate-400">
                        <span x-text="`Total: ${records.length} / 20`"></span>
                        <span x-show="records.length > 0"
                            x-text="`Sum: ${records.reduce((acc, r) => acc + r.kw, 0).toFixed(2)} kW`"></span>
                    </div>
                </div>
            </div>

            <!-- Reference Data Bottom -->
            <div class="bg-slate-800 p-6 rounded-2xl shadow-xl text-white">
                <h3 class="text-sm font-bold mb-4 flex items-center gap-2 opacity-80">
                    <i class="fas fa-book-open"></i>
                    <span x-text="lang === 'en' ? 'ASHRAE Reference Data' : 'Données de Référence ASHRAE'"></span>
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                    <template x-for="(factor, type) in ashraeFactors" :key="type">
                        <div class="bg-white/10 p-3 rounded-lg flex flex-col items-center text-center">
                            <span class="text-[10px] font-medium opacity-60 mb-1 truncate w-full"
                                x-text="t().roomTypes[type].split(' / ')[0]"></span>
                            <span class="text-xs font-black" x-text="factor + ' W/m²'"></span>
                        </div>
                    </template>
                </div>
                <p class="mt-4 text-[10px] text-white/40 italic text-center">
                    <i class="fas fa-info-circle mr-1"></i>
                    <span x-text="t().disclaimer"></span>
                </p>
            </div>
        </div>
    </main>

    <script>
        function app() {
            return {
                lang: 'en',
                area: 20,
                roomType: 'bedroom',
                factors: {
                    highSun: false,
                    poorInsulation: false,
                    extraOccupants: false,
                    electronics: false
                },
                records: [],
                ashraeFactors: {
                    bedroom: 100,
                    living_room: 120,
                    kitchen: 180,
                    office: 140,
                    server_room: 350,
                    gym: 220
                },
                adjustments: {
                    highSun: 0.10,
                    poorInsulation: 0.15,
                    extraOccupants: 0.10,
                    electronics: 0.10
                },
                translations: {
                    en: {
                        areaLabel: 'Cooling Area (m²)',
                        roomTypeLabel: 'Room Type',
                        resultsTitle: 'Recommended Capacity',
                        kwLabel: 'Kilowatts (kW)',
                        btuLabel: 'BTU per Hour (BTU/h)',
                        hpLabel: 'Horsepower (HP)',
                        disclaimer: 'Calculations are based on ASHRAE standard load factors. Adjustments are applied additively based on environmental conditions.',
                        factorsTitle: 'Environmental Factors (Optional)',
                        factors: {
                            highSun: 'High Sun Exposure (South-facing/Large windows)',
                            poorInsulation: 'Poor Insulation (Old building/Thin walls)',
                            extraOccupants: 'High Occupancy (>2 people regularly)',
                            electronics: 'Many Electronics/Appliances (Heat sources)'
                        },
                        roomTypes: {
                            bedroom: 'Bedroom / Rest Area',
                            living_room: 'Living Room / Lounge',
                            kitchen: 'Kitchen / Dining',
                            office: 'Office / Workspace',
                            server_room: 'Server / Tech Room',
                            gym: 'Gym / Fitness Area'
                        },
                        confirmBtn: 'Confirm & Add',
                        recordsTitle: 'Cooling Capacity Records',
                        exportBtn: 'Export to CSV',
                        clearAllBtn: 'Clear All',
                        noRecords: 'No records yet',
                        roomNamePrefix: 'Room'
                    },
                    fr: {
                        areaLabel: 'Surface à refroidir (m²)',
                        roomTypeLabel: 'Type de pièce',
                        resultsTitle: 'Estimation de Capacité',
                        kwLabel: 'Kilowatts (kW)',
                        btuLabel: 'BTU par heure (BTU/h)',
                        hpLabel: 'Chevaux (HP)',
                        disclaimer: 'Calculé selon les facteurs de charge standard ASHRAE. Les ajustements sont appliqués de manière additive.',
                        factorsTitle: 'Facteurs Environnementaux (Optionnel)',
                        factors: {
                            highSun: 'Exposition Solaire Élevée (Sud/Grandes fenêtres)',
                            poorInsulation: 'Isolation Faible (Vieux bâtiment/Murs fins)',
                            extraOccupants: 'Occupation Élevée (>2 personnes régulièrement)',
                            electronics: 'Nombreux Électronique (Sources de chaleur)'
                        },
                        roomTypes: {
                            bedroom: 'Chambre / Repos',
                            living_room: 'Salon / Séjour',
                            kitchen: 'Cuisine / Repas',
                            office: 'Bureau / Travail',
                            server_room: 'Serveur / Tech',
                            gym: 'Gym / Fitness'
                        },
                        confirmBtn: 'Confirmer & Ajouter',
                        recordsTitle: 'Registres de Capacité de Refroidissement',
                        exportBtn: 'Exporter en CSV',
                        clearAllBtn: 'Tout Effacer',
                        noRecords: 'Aucun registre pour le moment',
                        roomNamePrefix: 'Pièce'
                    }
                },
                t() {
                    return this.translations[this.lang];
                },
                get result() {
                    const baseLoad = this.ashraeFactors[this.roomType];
                    let totalMultiplier = 1;
                    if (this.factors.highSun) totalMultiplier += this.adjustments.highSun;
                    if (this.factors.poorInsulation) totalMultiplier += this.adjustments.poorInsulation;
                    if (this.factors.extraOccupants) totalMultiplier += this.adjustments.extraOccupants;
                    if (this.factors.electronics) totalMultiplier += this.adjustments.electronics;

                    const watts = this.area * baseLoad * totalMultiplier;
                    return {
                        watts: watts,
                        kw: watts / 1000,
                        btu: watts * 3.412142,
                        hp: (watts * 3.412142) / 9000,
                        adjustmentMultiplier: totalMultiplier
                    };
                },
                getRoomIcon(type) {
                    const icons = {
                        bedroom: 'fa-bed',
                        living_room: 'fa-couch',
                        kitchen: 'fa-utensils',
                        office: 'fa-briefcase',
                        server_room: 'fa-server',
                        gym: 'fa-dumbbell'
                    };
                    return 'fas ' + (icons[type] || 'fa-home');
                },
                addRecord() {
                    if (this.records.length >= 20) return;
                    this.records.push({
                        id: Date.now(),
                        roomName: `${this.t().roomNamePrefix} ${this.records.length + 1}`,
                        area: this.area,
                        kw: this.result.kw,
                        btu: this.result.btu,
                        hp: this.result.hp,
                        roomType: this.roomType
                    });
                },
                exportCSV() {
                    if (this.records.length === 0) return;

                    const headers = ['Room Name', 'Type', 'Area (m2)', 'Capacity (kW)', 'Capacity (BTU)', 'Capacity (HP)'];
                    const rows = this.records.map(r => [
                        r.roomName,
                        this.t().roomTypes[r.roomType],
                        r.area,
                        r.kw.toFixed(2),
                        Math.round(r.btu),
                        r.hp.toFixed(2)
                    ]);

                    const csvContent = "\ufeff" + [headers, ...rows].map(e => e.join(",")).join("\n");
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement("a");

                    const dateStr = new Date().toISOString().split('T')[0];
                    const fileName = `CoolCal_Pro_Records_${dateStr}.csv`;

                    link.href = url;
                    link.setAttribute("download", fileName);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }
            }
        }
    </script>
</body>

</html>